#!/bin/bash -e

# make-bios-usb n1wur14w.iso /dev/sdX

# T470s: https://support.lenovo.com/uu/en/downloads/ds120418/

iso=${1?iso missing}
device=${2?device missing}

# put old bios/dmi info in ~/lastbios, just in case shtf
# shellcheck disable=SC2024
cat /sys/class/dmi/id/bios_version &> ~/lastbios

size=$(stat -c %s "$iso")
[[ $size ]] || exit

# Byzantine process needed in order to do O_DIRECT and get progress
geteltorito.pl "$iso" |
    pv -s "$size" |
    sudo dd of="$device" obs=1M oflag=direct status=none
