#!/bin/bash -e

if (( $# )); then
    backup_paths=( "${@/#/"$HOME/.duply/"}" )
else
    backup_paths=( ~/.duply/* )
fi

for backup_path in "${backup_paths[@]}"; do
    backup_name=${backup_path##*/}
    pre=$backup_path/_pre
    post=$backup_path/_post

    [[ -x "$pre" ]] && "$pre"
    duply "$backup_name" backup
    (( VERIFY )) && duply "$backup_name" verify
    [[ -x "$post" ]] && "$post"
done
