#!/bin/bash

file=${1?}

if (( FULLSCREEN )); then
    s=$(xrandr --current | awk '$2 ~ /*/ { print $1 }')
    i=':0.0+0,0'
else
    read -r x y width height < <(slop -f "%x %y %w %h")
    s="$width"x"$height"
    i=":0.0+$x,$y"
fi

extra_args=()

(( LOSSLESS )) && extra_args+=(-qp 0 -preset ultrafast)

ffmpeg \
    -video_size "$s" \
    -framerate 25 \
    -f x11grab \
    -i "$i" \
    -vcodec libx264 \
    -threads 0 \
    "${extra_args[@]}" \
    "${file}"
