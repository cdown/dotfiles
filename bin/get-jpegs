#!/bin/bash -ex

in_dir=/mnt/sdcard/DCIM
out_dir=jpg/${1?}

shopt -s globstar nullglob

mkdir -p "$out_dir"

for raw_dir in "$in_dir"/**/; do
    if [[ "$in_dir/" == "$raw_dir" ]]; then
        continue
    fi
    inner_dir=${raw_dir#"$in_dir"/}
    jpg_dir=$out_dir/$inner_dir
    mkdir -p "$jpg_dir"
    arwtojpg "$raw_dir" "$jpg_dir"
done
