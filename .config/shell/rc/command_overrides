# vim: ft=sh

# If noglob (for zsh) is not available, just make it a noop
if ! command -v noglob >/dev/null 2>&1; then
    alias noglob=''
fi

# GNU Coreutils that might not be installed with default names on OSX.
# Lint warning for expansion at definition is disabled as that's intentional.
#
# shellcheck disable=SC2139
{
alias grep="$(use_first_to_exist ggrep grep)"
alias ls="$(use_first_to_exist gls ls) --color=auto -Ap --group-directories-first"
alias sed="$(use_first_to_exist gsed sed)"
alias awk="$(use_first_to_exist gawk awk)"
}

# Apply git environment changes for variable author, and do not glob. Bash use
# is infrequent enough not to worry too much. I don't care that much about
# bash completion, so it's not supported.
if [ "$ZSH_NAME" ]; then
    compdef git-variable-author=git
fi
alias git='noglob git-variable-author'

# Disable sourcing systemwide vim configuration
alias vim='vim -u ~/.vimrc -N'

# Do not disable raw control chars when running less
alias less='less -R'

alias sxiv='sxiv -b'
alias ipython='ipython --no-banner'

# Do not pass a (potentially unsupported) locale when SSHing to random servers.
# In mosh, a UTF-8 aware locale is needed, so we use en_US.UTF-8 because
# there's a high likelihood that it will be available ('Murica baby!).
safe_termname() {
    case $TERM in
        rxvt*) echo rxvt ;;
        xterm*) echo xterm ;;
        *) echo linux ;;
    esac
}
alias ssh='LC_ALL=C TERM="$(safe_termname)" ssh'
alias mosh='LC_ALL=en_US.UTF-8 mosh'

# Allow other aliases to be used after the program name
alias sudo='sudo '
alias watch='watch '

# If the makepkg user exists, it should take responsibility for all package
# building
if id makepkg >/dev/null 2>&1; then
    alias pacman='sudo -u makepkg sudo pacman'

    # The linter warns that "yaourt" is being passed over sudo, which won't
    # work, but this one is actually fine because we *want* to call the raw
    # binary (not the alias) after sudoing

    # shellcheck disable=SC2033
    yaourt-cd() ( cd / && sudo -u makepkg yaourt "$@" )
    # shellcheck disable=SC2032
    alias yaourt=yaourt-cd
fi

# If vim is present, use the bundled less.sh as less
if command -v vim >/dev/null 2>&1; then
    # shellcheck disable=SC2016
    vim_runtime_dir=$(
        vim -e -T dumb --cmd 'exe "set t_cm=\<C-M>"|echo $VIMRUNTIME|quit' |
            tr -d '\015'
    )

    # shellcheck disable=SC2139
    alias less="$vim_runtime_dir/macros/less.sh"
fi
